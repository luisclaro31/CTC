<?php /* * Controlador Menu con metodos principales * Excellentiam S.E. * Fecha creacion: 13/09/14 */if ( ! defined('BASEPATH')) exit('No direct script access allowed');class controladorMenu extends CI_Controller{   public function __construct()   {        parent::__construct();        $this->load->model('procedimientos_model');              $this->load->helper('url');        $this->load->helper(array('url', 'form'));        $this->load->library(array('session','form_validation'));                        $this->load->library('form_validation');    }   function index()   {       if($this->session->userdata('esLogueado') == FALSE)                    redirect('login');                       $parametros = $this->ObtenerListaValoresMenu();         $this->load->view('vistaMenu', $parametros);   }   function ConsultarMenu($idMenu, $consultar = "")   {        $registro = $this->procedimientos_model->GetProcedure("menu_seleccionar_por_id","'$idMenu'");        $parametros = $this->ObtenerListaValoresMenu();        $parametros['registros'] = $registro;        $parametros['consultar'] = $consultar;        $this->load->view('vistaMenu', $parametros);   }   public function AdicionarMenu()   {        $rpta = $this->procedimientos_model->SetProcedure("menu_insertar",                "'".$_POST['txtNivelMenuAdic']."',                '".$_POST['txtNombreMenuAdic']."',                '".$_POST['txtOrdenAdic']."',                '".$_POST['txtUrlAdic']."',                '".$_POST['txtIdMenuPadreAdic']."'                ");       $parametros = $this->ObtenerListaValoresMenu();       if(!$rpta)           $parametros['estadoAdicionar'] = false;        else           $parametros['estadoAdicionar'] = true;        $this->load->view('vistaMenu', $parametros);    }   function EliminarMenu($id)   {        $rpta = $this->procedimientos_model->SetProcedure("menu_eliminar","'$id'");        $parametros = $this->ObtenerListaValoresMenu();        if(!$rpta)           $parametros['estadoEliminar'] = false;        else           $parametros['estadoEliminar'] = true;        $this->load->view('vistaMenu', $parametros);    }   public function ModificarMenu()   {       $rpta = $this->procedimientos_model->SetProcedure("menu_modificar",                "'".$_POST['txtId']."',                '".$_POST['txtNivelMenu']."',                '".$_POST['txtNombreMenu']."',                '".$_POST['txtOrden']."',                '".$_POST['txtUrl']."',                '".$_POST['txtIdMenuPadre']."'                ");        $parametros = $this->ObtenerListaValoresMenu();       if(!$rpta)           $parametros['estadoModificar'] = false;       else           $parametros['estadoModificar'] = true;       $this->load->view('vistaMenu', $parametros);   }   /*    * Consulta detallada por rut    */   public function ConsultarEmpresaPorRut($rut)   {        $registroEmpresa = $this->procedimientos_model->GetProcedure("empresa_seleccionar_por_rut","'$rut'");        if(isset($registroEmpresa[0]['sigla']))            $sigla = $registroEmpresa[0]['sigla'];        else            $sigla =  '';        if(isset($registroEmpresa[0]['descripcion_departamento']))            $departamento = $registroEmpresa[0]['descripcion_departamento'];        else            $departamento =  '';        if(isset($registroEmpresa[0]['descripcion_municipio']))            $municipio = $registroEmpresa[0]['descripcion_municipio'];        else            $municipio =  '';        if(isset($registroEmpresa[0]['direccion']))            $direccion = $registroEmpresa[0]['direccion'];        else            $direccion =  '';        if(isset($registroEmpresa[0]['telefonos']))            $telefonos = $registroEmpresa[0]['telefonos'];        else            $telefonos =  '';        if(isset($registroEmpresa[0]['descripcion_clasificacion_economica']))            $clasificacionEconomica = $registroEmpresa[0]['descripcion_clasificacion_economica'];        else            $clasificacionEconomica =  '';        echo utf8_encode('<table align="left" width="500" cellpadding="4">                <tr>                    <td align="left" class="tdFormulario">                        <label>Sigla Empresa</label>                    </td>                    <td align="left" class="tdFormulario">                        '.utf8_decode($sigla).'                    </td>                </tr>                <tr>                    <td align="left" class="tdFormulario">                        <label>Departamento Sede Empresa</label>                    </td>                    <td align="left" class="tdFormulario">                        '.utf8_decode($departamento).'                    </td>                </tr>                <tr>                    <td align="left" class="tdFormulario">                        <label>Municipio sede empresa</label>                    </td>                    <td align="left" class="tdFormulario">                        '.utf8_decode($municipio).'                    </td>                </tr>                <tr>                    <td align="left" class="tdFormulario">                        <label>Dirección Sede Empresa</label>                    </td>                    <td align="left" class="tdFormulario">                        '.utf8_decode($direccion).'                    </td>                </tr>                <tr>                    <td align="left" class="tdFormulario">                        <label>Teléfono de la empresa</label>                    </td>                    <td align="left" class="tdFormulario">                        '.utf8_decode($telefonos).'                    </td>                </tr>                <tr>                    <td align="left" class="tdFormulario">                        <label>Clasificación Económica</label>                    </td>                    <td align="left" class="tdFormulario">                        '.utf8_decode($clasificacionEconomica).'                    </td>                </tr>            </table>');   }   /*    * Validar menu existente    */   public function ValidarMenu($menu)   {       $existe = $this->procedimientos_model->GetProcedure("menu_validar_menu","'$menu'");              if($existe[0]['count'] > 0)        echo 'El menu ya existe, escriba uno nuevo.';   }   /*    * Generación de excel    */   public function GenerarExcel()   {}   /*    * Generación de pdf    */   public function GenerarPdf()   {}   /*    * Listas de valores básicas    */   private function ObtenerListaValoresMenu()   {       $registrosConsultaMenu = $this->procedimientos_model->GetProcedure("menu_seleccionar","");       $usuario = array('perfil' => $this->session->userdata('perfil'),                        'idUsuario' => $this->session->userdata('idUsuario'),                        'usuario' => $this->session->userdata('usuario'));       $datosVistaMenu = array(                    'registros' => $registrosConsultaMenu,                    'usuario'=> $usuario                );       return $datosVistaMenu;   }}